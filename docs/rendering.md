# 렌더링 시점 비교
## SPA (Single Page Application) / CSR (Client Side Rendering)

- 웹 페이지의 초기 로딩은 정적 HTML로 이뤄지나 이후 클라이언트 측 JavaScript로 동적 콘텐츠를 렌더링함.
- CSR의 경우 초기 로딩 속도는 느리지만, 이후에는 서버에 다시 요청할 필요없이 클라이언트(브라우저) 내에서 캐싱된 자원(html, js 등)을 가져오므로 빠름.
- 초기 로딩 속도가 느리므로 SSR에 비해 검색 엔진 최적화(SEO)에 불리함. (에를 들어 각 라우터마다 동적인 메타 값을 원한다면 `react-helmet`과 같은 별도의 라이브러리가 필요함)
 
### CSR 을 보투게더 메인 홈(게시글 목록 페이지)에 적용

- 메인 홈페이지는 TanStack Query의 `useInfiniteQuery`를 이용하여 데이터를 fetchin 하고 있습니다.
- 이미 서버 상태 관리 라이브러리를 활용하고 있는데 이를 SSR 페이지로 대규모 리팩터링할 필요가 없다고 판단했습니다.
- 또한 게시글 투표 등 굉장히 많은 사용자 동작이 메인 홈에 포함되므로, 명확하게 CSR이 적합하다고 판단했습니다.

## SSG (Static Site Generation)

- 웹 페이지가 `미리 빌드된 정적 파일`로 생성됨.
- 사전에 데이터를 가져와 페이지를 생성하고 웹 서버에 배포함.
- 렌더링 속도가 빠르며 CDN을 사용하여 캐싱 및 배포가 쉬움.
- Data Fetching은 빌드타임에 이루어지므로 콘텐츠가 거의 바뀌지 않는 페이지에 적합함.

## SSR (Server Side Rendering)

- 웹 페이지는 서버 측에서 동적으로 렌더링됨.
- `각 요청마다` 서버에서 페이지를 생성하여 클라이언트에 전달함.
- 초기 로딩 속도가 빠르나 `서버에 부하`가 걸릴 수 있음.

## ISR (Incremental Static Regeneration)

- SSG의 변형으로, next 13 에는 fetch 함수에 `revalidate`라는 옵션을 주면 매번 새롭게 빌드를 하지 않더라도 주기적으로 새로운 데이터를 불러옴.
- 특정 페이지의 데이터가 업데이트되면 이 페이지만 다시 빌드되며, 다른 페이지는 그대로 유지됨.
- 동적 데이터를 가진 페이지를 최신 상태로 유지하면서 성능을 개선할 수 있음.

### ISR 을 보투게더 랭킹 페이지에 적용

- 보투게더의 랭킹은 사용자들의 투표 수 등 활동 내역을 기반으로 정해지는데, 랭킹은 짧게는 30분, 길게는 2주의 변동 주기를 띠고 있습니다.
- 따라서 해당 페이지에서 fetch하는 데이터는 revalidate 옵션을 30분으로 설정하고 있습니다.

# 사용자 경험(UX) 측면 분석

## SPA / CSR

- CSR은 `Pre-rendering을 하지 않고` 데이터를 매번 컴포넌트가 마운트 될 때마다 불러오므로, SEO나 로딩 속도는 현저히 떨어지는 한계가 있음.
- 그러나 `사용자 입력에 즉각 반응`하여 나은 UX 전달할 수도 있다는 장점이 있음.

## SSG

- 콘텐츠가 거의 바뀌지 않거나 `사용자의 동작이 거의 없는`` 페이지에 적합함.
- 다른 페이지로 라우팅되는 동작(예를 들어 랭킹 페이지로 라우팅)만 제공하는 페이지에 적합해 보임.
- 사용자의 동작이 없는 대신, 시각적인 효과(CSS 등)로 커버하여 UI를 풍부하게 구성하는 것이 최선이라고 생각함.

## SSR

- `페이지 전체가 로딩 전에는 볼 수 없다`는 단점이 있으므로, 로딩 UI 를 통해 사용자에게 `로딩 상태라는 것`을 명확히 전달해야 함.
- 페이지 전체를 서버로부터 fetch 하는 속도가 CSR의 렌더링 속도보다는 빠르기 때문에, 개선된 SEO 와 `페이지 진입 시 사용자의 대기 시간을 줄일 수 있음`.
- 새로고침을 하는 경우 다시 한번 페이지 전체를 fetch 해서 보여주기 때문에 깜빡임 현상이 있음. (UX 저해 요소가 됨)

## ISR

- 콘텐츠가 바뀔 필요는 있지만, 바뀌는 주기가 빈번하지 않아도 되는 경우에 적합함.
- 예를 들어, 뉴스나 블로그 게시물, 제품 카탈로그, 댓글 목록 등이 있는 ISR에 적합한 데이터임.
- 이러한 데이터는 캐싱되었다가, 매 요청마다 업데이트할 필요가 없는 경우들이며 주기(revalidate 옵션)이 지난 타이밍에 요청이 들어오면 업데이트됨.

# 성능 측정 및 비교

### SPA / CSR

기존에 보투게더의 랭킹 페이지는 CSR로 렌더링되며, Lighthouse 로 측정한 결과는 아래와 같습니다.

(테스트 환경은 한국, 데스크탑입니다.)

![csr-lighthouse](https://github.com/inyeong-kang/frontend-rendering/assets/81199414/a21b3294-62bc-435a-81ea-f6c633334e05)


Webpage Test 결과, LCP는 아래와 같습니다.

(테스트 환경은 4G, 미국, 모바일입니다.)

![csr-web](https://github.com/inyeong-kang/frontend-rendering/assets/81199414/6c949eac-5c3a-4926-ab28-20fe0654b7ee)


### ISR

클론한 보투게더의 랭킹 페이지는 ISR로 렌더링되며, Lighthouse 로 측정한 결과는 아래와 같습니다.

(테스트 환경은 한국, 데스크탑입니다.)
![isr-lighthouse](https://github.com/inyeong-kang/frontend-rendering/assets/81199414/c6f381fe-0e5c-41e1-ae8f-d912def176b1)


Webpage Test 결과, LCP는 아래와 같습니다.

(테스트 환경은 CSR과 같습니다.)
![isr-web](https://github.com/inyeong-kang/frontend-rendering/assets/81199414/4e3265e8-4063-4aee-9ba0-8b7f5bc2ab27)



---

### 데스크탑에서 Lighthouse 측정 결과 비교 분석

ISR 로 구현하면 유의미한 성능(Lighthouse Performance) 차이가 있을 것으로 예상했었습니다.
사실 CSR 로 구현한 기존의 보투게더 페이지가 번들 사이즈 관련된 성능 최적화가 잘 적용되어 있습니다.

1. ngnix의 cache-control로 bundle.js 캐싱 하도록 함.
2. bundle.js 압축률을 높여 서버에서 가져오는 bundle.js 의 크기를 대폭 줄임

이러한 성능 최적화 덕분에 CSR로 렌더링하더라도 초기 로딩 속도가 빠르며, ISR로 렌더링한 결과와 크게 다르지 않음을 확인할 수 있습니다.

### 모바일에서 WebPage Test 측정 결과 비교 분석

ISR의 위력은 WebPage Test 를 통해 체감할 수 있었습니다. 모바일 환경이라서 SSR과 CSR의 차이가 더더욱 커진 것으로 보이는데요, `3배 이상 초기 로딩 속도가 빨라진 것`을 확인할 수 있었습니다.
